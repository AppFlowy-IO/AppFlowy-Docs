<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="811px" preserveAspectRatio="none" style="width:662px;height:811px;background:#FFFFFF;" version="1.1" viewBox="0 0 662 811" width="662px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="29.1201" id="_title" style="stroke:none;stroke-width:1.0;" width="183" x="232.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="173" x="237.5" y="26.0439">Protobuf Communication</text><g id="cluster_##2"><rect fill="none" height="758" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:1.0;" width="649" x="7" y="47.1201"/></g><!--MD5=[1e3fa4b2d53fbd1b94b9b9aa2ab19738]
cluster frontend (Flutter)--><g id="cluster_frontend (Flutter)"><path d="M368.5,71.1201 L491.5,71.1201 A3.75,3.75 0 0 1 494,73.6201 L501,96.2402 L629.5,96.2402 A2.5,2.5 0 0 1 632,98.7402 L632,324.6201 A2.5,2.5 0 0 1 629.5,327.1201 L368.5,327.1201 A2.5,2.5 0 0 1 366,324.6201 L366,73.6201 A2.5,2.5 0 0 1 368.5,71.1201 " fill="#DDDDDD" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="366" x2="501" y1="96.2402" y2="96.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="122" x="370" y="89.1641">frontend (Flutter)</text></g><!--MD5=[6ea7d2dbc82f075829b7c7b81681166d]
cluster Backend (Rust)--><g id="cluster_Backend (Rust)"><path d="M368.5,378.1201 L476.5,378.1201 A3.75,3.75 0 0 1 479,380.6201 L486,403.2402 L625.5,403.2402 A2.5,2.5 0 0 1 628,405.7402 L628,768.6201 A2.5,2.5 0 0 1 625.5,771.1201 L368.5,771.1201 A2.5,2.5 0 0 1 366,768.6201 L366,380.6201 A2.5,2.5 0 0 1 368.5,378.1201 " fill="#DDDDDD" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="366" x2="486" y1="403.2402" y2="403.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="107" x="370" y="396.1641">Backend (Rust)</text></g><g id="elem_GMN7"><path d="M23.5,84.1201 L23.5,182.8921 A0,0 0 0 0 23.5,182.8921 L346.5,182.8921 A0,0 0 0 0 346.5,182.8921 L346.5,137.6201 L381.98,133.6201 L346.5,129.6201 L346.5,94.1201 L336.5,84.1201 L23.5,84.1201 A0,0 0 0 0 23.5,84.1201 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M336.5,84.1201 L336.5,94.1201 L346.5,94.1201 L336.5,84.1201 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="29.5" y="104.0181">class FolderEventExportDocument {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="45.5" y="121.7725">Future&lt;Either&lt;ExportData, FlowyError&gt;&gt; send() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="61.5" y="139.5269">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="45.5" y="157.2813">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="29.5" y="175.0356">}</text></g><g id="elem_GMN14"><path d="M79,672.1201 L79,788.6465 A0,0 0 0 0 79,788.6465 L347,788.6465 A0,0 0 0 0 347,788.6465 L347,734.6201 L382.48,730.6201 L347,726.6201 L347,682.1201 L337,672.1201 L79,672.1201 A0,0 0 0 0 79,672.1201 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M337,672.1201 L337,682.1201 L347,682.1201 L337,672.1201 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="85" y="692.0181">pub(crate) async fn export_handler(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="101" y="709.7725">data: Data&lt;ExportPayload&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="101" y="727.5269">controller: Unit&lt;Arc&lt;ViewController&gt;&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="85" y="745.2813">) -&gt; DataResult&lt;ExportData, FlowyError&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="101" y="763.0356">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="85" y="780.79">}</text></g><!--MD5=[4e260e4024c27e03c495c33059d2b5ff]
entity Repository--><g id="elem_Repository"><rect fill="#F1F1F1" height="49.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="382" y="109.1201"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="470" y="114.1201"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="468" y="116.1201"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="468" y="120.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="397" y="145.1641">Repository</text></g><!--MD5=[78e0d1133500ea5a75200a919f68dfaf]
entity FFI_Frontend--><g id="elem_FFI_Frontend"><rect fill="#FFDDDD" height="49.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="61" x="405.5" y="262.1201"/><rect fill="#FFDDDD" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="446.5" y="267.1201"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="444.5" y="269.1201"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="444.5" y="273.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="420.5" y="298.1641">FFI</text></g><!--MD5=[852a81768349dd0bcf262751242e7ec8]
entity Crate--><g id="elem_Crate"><rect fill="#F1F1F1" height="49.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="382.5" y="706.1201"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="437.5" y="711.1201"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="435.5" y="713.1201"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="435.5" y="717.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="397.5" y="742.1641">Crate</text></g><!--MD5=[8438b603195005c18d5011c1879083f4]
entity Dispatcher--><g id="elem_Dispatcher"><rect fill="#FFDDDD" height="49.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="382" y="544.1201"/><rect fill="#FFDDDD" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="470" y="549.1201"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="468" y="551.1201"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="468" y="555.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="397" y="580.1641">Dispatcher</text></g><!--MD5=[179e2604d0e0114e09ff0fc2b2cdbe9a]
entity FFI_Backend--><g id="elem_FFI_Backend"><rect fill="#FFDDDD" height="49.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="61" x="405.5" y="416.1201"/><rect fill="#FFDDDD" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="446.5" y="421.1201"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="444.5" y="423.1201"/><rect fill="#FFDDDD" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="444.5" y="427.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="420.5" y="452.1641">FFI</text></g><!--MD5=[a2160a1f3fca2f537bfc003f6f9e328a]
link Repository to Repository--><g id="link_Repository_Repository"><path d="M490.32,117.1301 C509.46,116.8701 525,122.3601 525,133.6201 C525,143.8201 512.24,149.2901 495.6,150.0301 " fill="none" id="Repository-to-Repository" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="490.32,150.1101,499.3762,153.9812,495.3195,150.0387,499.2619,145.982,490.32,150.1101" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="531" y="140.0181">1.ExportPayload</text></g><!--MD5=[38d973180e405282d57257eaaecfdf7c]
link Repository to FFI_Frontend--><g id="link_Repository_FFI_Frontend"><path d="M436,158.2101 C436,184.7601 436,227.9101 436,256.5301 " fill="none" id="Repository-to-FFI_Frontend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="436,261.6901,440,252.6901,436,256.6901,432,252.6901,436,261.6901" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="437" y="229.0181">2. Event + ExportPayload</text></g><!--MD5=[4de8113ca68441e6ab054604d393395d]
link FFI_Frontend to FFI_Backend--><g id="link_FFI_Frontend_FFI_Backend"><path d="M436,311.3701 C436,338.2501 436,382.0401 436,410.8401 " fill="none" id="FFI_Frontend-to-FFI_Backend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="436,416.0401,440,407.0401,436,411.0401,432,407.0401,436,416.0401" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="437" y="359.0181">3.Bytes</text></g><!--MD5=[4995e94678fa022b3b0236d8d155fc5d]
link FFI_Backend to Dispatcher--><g id="link_FFI_Backend_Dispatcher"><path d="M436,465.3201 C436,486.1701 436,516.6001 436,538.8401 " fill="none" id="FFI_Backend-to-Dispatcher" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="436,544.0301,440,535.0301,436,539.0301,432,535.0301,436,544.0301" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="437" y="511.0181">4: Event + ExportPayload</text></g><!--MD5=[7c34829781f2f21cb5004b050203a686]
link Dispatcher to Crate--><g id="link_Dispatcher_Crate"><path d="M433.64,593.2301 C430.78,621.8201 425.96,669.9801 422.89,700.7601 " fill="none" id="Dispatcher-to-Crate" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="422.37,705.9101,427.2262,697.3417,422.8562,700.9338,419.2641,696.5638,422.37,705.9101" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="431" y="639.0181">5.ExportPayload</text></g><!--MD5=[9f24cc3c7d8f7d0640b8cbb231d1733c]
link Crate to Crate--><g id="link_Crate_Crate"><path d="M457.67,712.7401 C476.13,710.4001 492.5,716.3601 492.5,730.6201 C492.5,743.5401 479.05,749.6501 462.8,748.9401 " fill="none" id="Crate-to-Crate" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="457.67,748.5001,466.2944,753.2562,462.6516,748.9283,466.9795,745.2856,457.67,748.5001" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="498.5" y="737.0181">6. call export_handler</text></g><!--MD5=[ff9972f7a636e1f64ddffc9c5ca0761b]
@startuml FlowySDK
title Protobuf Communication
top to bottom direction
'skinparam linetype polyline

rectangle {
    package "frontend (Flutter)" #DDDDDD {
        component Repository
        component FFI_Frontend as "FFI" #FFDDDD
    }
    note left of Repository
    class FolderEventExportDocument {
        Future<Either<ExportData, FlowyError>> send() {
            ...
        }
    }
    end note

    package "Backend (Rust)" #DDDDDD {
        component Crate
        component Dispatcher as "Dispatcher" #FFDDDD
        component FFI_Backend as "FFI" #FFDDDD
    }
    note left of Crate
    pub(crate) async fn export_handler(
        data: Data<ExportPayload>,
        controller: Unit<Arc<ViewController>>,
    ) -> DataResult<ExportData, FlowyError> {
        ...
    }
    end note
}

Repository - -> Repository: 1.ExportPayload
Repository - -> FFI_Frontend: 2. Event + ExportPayload
FFI_Frontend - -> FFI_Backend: 3.Bytes
FFI_Backend - -> Dispatcher: 4: Event + ExportPayload
Dispatcher - -> Crate: 5.ExportPayload
Crate - -> Crate : 6. call export_handler
@enduml

@startuml FlowySDK
title Protobuf Communication
top to bottom direction

rectangle {
    package "frontend (Flutter)" #DDDDDD {
        component Repository
        component FFI_Frontend as "FFI" #FFDDDD
    }
    note left of Repository
    class FolderEventExportDocument {
        Future<Either<ExportData, FlowyError>> send() {
            ...
        }
    }
    end note

    package "Backend (Rust)" #DDDDDD {
        component Crate
        component Dispatcher as "Dispatcher" #FFDDDD
        component FFI_Backend as "FFI" #FFDDDD
    }
    note left of Crate
    pub(crate) async fn export_handler(
        data: Data<ExportPayload>,
        controller: Unit<Arc<ViewController>>,
    ) -> DataResult<ExportData, FlowyError> {
        ...
    }
    end note
}

Repository - -> Repository: 1.ExportPayload
Repository - -> FFI_Frontend: 2. Event + ExportPayload
FFI_Frontend - -> FFI_Backend: 3.Bytes
FFI_Backend - -> Dispatcher: 4: Event + ExportPayload
Dispatcher - -> Crate: 5.ExportPayload
Crate - -> Crate : 6. call export_handler
@enduml

PlantUML version 1.2022.12(Mon Oct 24 02:12:26 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>